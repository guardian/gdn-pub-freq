{% extends 'base.html' %}

{% block title %}Publication by hour for {{date_string}}{% endblock %}

{% block content %}
<div class="container">
	<div class="row">
		<div class="col-md-12">
			<h1 class="article-heading">Publishing history for {{date.strftime('%d/%m/%Y')}}</h1>

			<p>{{date.strftime("%A")}}{% if production_office %}; production office: {{production_office|upper}}{% endif %}<br><em>Left/right arrows yesterday/tomorrow or <a href="/day/{{date_string}}/previous">previous day</a>, <a href="/day/{{date_string}}/next">next day</a>, <a href="/day/{{date_string}}/previous/week">previous week</a>, <a href="/day/{{date_string}}/next/week">next week</a></em></p>
			<div>
			<canvas id="barChart" width="800" height="400"></canvas>
			</div>
		</div>
	</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.js"></script>

<script>
//Chart.defaults.global.responsive = true;

var ctx = document.getElementById("barChart").getContext("2d");

var data = {
	labels: ['0', '1'],
	datasets: [{
		data: [12,15]
	}]
};

$.ajax({
  dataType: "json",
  url: "{{api_url}}",
  success: function(data) {
  	var options = {
  		animationEasing: 'easeOutExpo'
  	};
  	var chartData = {
  		labels: data.hour_series,
  		datasets: [
  			{
		  		fillColor: '#2e3192',
		  		strokeColor: '#2e3192',
  				data: data.count_series
  			}
  		]
  	};
  	var myBarChart = new Chart(ctx).Bar(chartData, options);

  	document.getElementById("barChart").onclick = function(evt){
    var activeBars = myBarChart.getBarsAtEvent(evt);
    if(activeBars) {
	    //console.log(activeBars[0].label);
	    window.location.replace('/day/{{date_string}}/hour/' + activeBars[0].label);
	}
    };
  }
});

$(window).keyup(function(event){
	//alert(event.which);
	if(event.which === 39) {
		window.location.replace('/day/{{date_string}}/next');
	}

	if(event.which === 37) {
		window.location.replace('/day/{{date_string}}/previous');
	}
});

</script>
{% endblock %}
